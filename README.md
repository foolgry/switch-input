# è¾“å…¥æ³•è‡ªåŠ¨åˆ‡æ¢å·¥å…·

ä¸€ä¸ªåŸºäº Go å¼€å‘çš„è½»é‡çº§è¾“å…¥æ³•è‡ªåŠ¨åˆ‡æ¢å·¥å…·ï¼Œä¸“ä¸º macOS è®¾è®¡ï¼Œé€šè¿‡ç³»ç»ŸçŠ¶æ€æ è¿è¡Œï¼Œæ ¹æ®å½“å‰æ´»åŠ¨çª—å£è‡ªåŠ¨åˆ‡æ¢è¾“å…¥æ³•ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- **æ™ºèƒ½çª—å£æ£€æµ‹** - å®æ—¶ç›‘æ§æ´»åŠ¨çª—å£å˜åŒ–
- **è‡ªåŠ¨è¾“å…¥æ³•åˆ‡æ¢** - æ ¹æ®é…ç½®è§„åˆ™è‡ªåŠ¨åˆ‡æ¢è¾“å…¥æ³•
- **çŠ¶æ€æ é›†æˆ** - é€šè¿‡ç³»ç»ŸçŠ¶æ€æ æ§åˆ¶ï¼Œæ— å¹²æ‰°è¿è¡Œ
- **é…ç½®æ–‡ä»¶ç®¡ç†** - æ”¯æŒæ‰‹åŠ¨ç¼–è¾‘é…ç½®æ–‡ä»¶

### âš™ï¸ æŠ€æœ¯ç‰¹æ€§
- **è½»é‡çº§è®¾è®¡** - ä½å†…å­˜å ç”¨å’ŒCPUä½¿ç”¨
- **im-select é›†æˆ** - ä¾èµ– im-select å·¥å…·è¿›è¡Œè¾“å…¥æ³•åˆ‡æ¢
- **macOS ä¸“ç”¨** - é’ˆå¯¹ macOS ç³»ç»Ÿä¼˜åŒ–
- **åå°è¿è¡Œ** - ä½œä¸ºç³»ç»ŸæœåŠ¡åœ¨åå°è¿è¡Œ

## ç³»ç»Ÿè¦æ±‚

- macOS 10.15+
- Go 1.21+
- im-select å·¥å…·ï¼ˆé€šè¿‡ Homebrew å®‰è£…ï¼‰

## å®‰è£…å’Œä½¿ç”¨

### 1. å®‰è£… im-select

```bash
brew install im-select
```

### 2. æ„å»ºåº”ç”¨

```bash
git clone <repository-url>
cd switch-input
go mod tidy
go build -o build/bin/switch-input
```

### 3. è¿è¡Œåº”ç”¨

```bash
./build/bin/switch-input
```

åº”ç”¨å¯åŠ¨åä¼šåœ¨ç³»ç»ŸçŠ¶æ€æ æ˜¾ç¤ºå›¾æ ‡ï¼Œå¯ä»¥é€šè¿‡çŠ¶æ€æ èœå•è¿›è¡Œæ§åˆ¶ã€‚

## é…ç½®è¯´æ˜

### é…ç½®æ–‡ä»¶ä½ç½®
- ä¸»é…ç½®æ–‡ä»¶ï¼š`config.json`

### é…ç½®ç¤ºä¾‹

```json
{
    "rules": [
        {
            "app": "com.apple.Safari,WeChat,Safari,Brave Browser,Google Chrome",
            "window": "",
            "input": "com.tencent.inputmethod.wetype.pinyin",
            "enabled": true,
            "priority": 1
        },
        {
            "app": "com.apple.Terminal,Terminal,iTerm",
            "window": "",
            "input": "com.apple.keylayout.ABC",
            "enabled": true,
            "priority": 1
        },
        {
            "app": "com.microsoft.VSCode,VSCode,Electron",
            "window": "",
            "input": "com.apple.keylayout.ABC",
            "enabled": true,
            "priority": 1
        }
    ],
    "general": {
        "autoStart": false,
        "checkInterval": 500,
        "switchDelay": 100,
        "enableLogging": true,
        "logLevel": "info",
        "showNotifications": true
    }
}
```

### è§„åˆ™é…ç½®è¯´æ˜
- `app`: åº”ç”¨ç¨‹åºåŒ…åï¼ˆæ”¯æŒé€—å·åˆ†éš”å¤šä¸ªåº”ç”¨ï¼‰
- `window`: çª—å£åç§°åŒ¹é…ï¼ˆå¯é€‰ï¼Œå½“å‰æœªä½¿ç”¨ï¼‰
- `input`: ç›®æ ‡è¾“å…¥æ³•ID
- `enabled`: æ˜¯å¦å¯ç”¨è¯¥è§„åˆ™
- `priority`: ä¼˜å…ˆçº§ï¼ˆæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼‰

### é€šç”¨é…ç½®è¯´æ˜
- `autoStart`: æ˜¯å¦å¼€æœºè‡ªå¯åŠ¨ï¼ˆå½“å‰æœªå®ç°ï¼‰
- `checkInterval`: çª—å£æ£€æµ‹é—´éš”ï¼ˆæ¯«ç§’ï¼‰
- `switchDelay`: è¾“å…¥æ³•åˆ‡æ¢å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
- `enableLogging`: æ˜¯å¦å¯ç”¨æ—¥å¿—è®°å½•
- `logLevel`: æ—¥å¿—çº§åˆ«
- `showNotifications`: æ˜¯å¦æ˜¾ç¤ºé€šçŸ¥ï¼ˆå½“å‰æœªå®ç°ï¼‰

## æ”¯æŒçš„è¾“å…¥æ³•

ç›®å‰æ”¯æŒçš„è¾“å…¥æ³•ä¸»è¦åŒ…æ‹¬ï¼š
- `com.apple.keylayout.ABC` - è‹±æ–‡é”®ç›˜
- `com.tencent.inputmethod.wetype.pinyin` - å¾®ä¿¡æ‹¼éŸ³è¾“å…¥æ³•

å¯ä»¥é€šè¿‡ `im-select` å‘½ä»¤æŸ¥çœ‹å½“å‰è¾“å…¥æ³•IDï¼š
```bash
im-select
```

## é¡¹ç›®ç»“æ„

```
switch-input/
â”œâ”€â”€ main.go              # åº”ç”¨ç¨‹åºå…¥å£å’ŒçŠ¶æ€æ å¤„ç†
â”œâ”€â”€ app.go               # æ ¸å¿ƒåº”ç”¨é€»è¾‘
â”œâ”€â”€ config.json          # é…ç½®æ–‡ä»¶
â”œâ”€â”€ services/            # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ window.go        # çª—å£æ£€æµ‹æœåŠ¡
â”‚   â”œâ”€â”€ input.go         # è¾“å…¥æ³•ç®¡ç†æœåŠ¡ï¼ˆä»…ä½¿ç”¨ im-selectï¼‰
â”‚   â”œâ”€â”€ matcher.go       # è§„åˆ™åŒ¹é…å¼•æ“
â”‚   â””â”€â”€ logger.go        # æ—¥å¿—è®°å½•æœåŠ¡
â”œâ”€â”€ build/               # æ„å»ºè¾“å‡º
â”‚   â””â”€â”€ bin/             # å¯æ‰§è¡Œæ–‡ä»¶
â””â”€â”€ go.mod               # Go æ¨¡å—æ–‡ä»¶
```

## æŠ€æœ¯å®ç°

### è¾“å…¥æ³•ç®¡ç†
- ä½¿ç”¨ `im-select` å·¥å…·è·å–å½“å‰è¾“å…¥æ³•
- ä½¿ç”¨ `im-select <input_id>` åˆ‡æ¢è¾“å…¥æ³•
- ç§»é™¤äº†æ‰€æœ‰å¤‡ç”¨æ–¹æ¡ˆå’Œå¤æ‚é€»è¾‘

### çª—å£æ£€æµ‹
- é€šè¿‡ macOS ç³»ç»ŸAPIç›‘æ§æ´»åŠ¨çª—å£å˜åŒ–
- æ”¯æŒåº”ç”¨ç¨‹åºåŒ…ååŒ¹é…
- å¯é…ç½®æ£€æµ‹é—´éš”å’Œåˆ‡æ¢å»¶è¿Ÿ

### çŠ¶æ€æ é›†æˆ
- ä½¿ç”¨ `systray` åº“åˆ›å»ºç³»ç»ŸçŠ¶æ€æ å›¾æ ‡
- æä¾›æ‰“å¼€é…ç½®æ–‡ä»¶å’Œé€€å‡ºåŠŸèƒ½
- ç®€æ´çš„ç”¨æˆ·ç•Œé¢

## å¼€å‘è¯´æ˜

### ä¾èµ–é¡¹
- `github.com/getlantern/systray` - çŠ¶æ€æ åŠŸèƒ½
- æ ‡å‡†åº“ `os/exec` - æ‰§è¡Œç³»ç»Ÿå‘½ä»¤
- æ ‡å‡†åº“ `runtime` - è¿è¡Œæ—¶ä¿¡æ¯

### æ„å»ºå‘½ä»¤
```bash
# å¼€å‘æ„å»º
go build -o build/bin/switch-input

# ç”Ÿäº§æ„å»º
go build -ldflags="-s -w" -o build/bin/switch-input
```

## æ³¨æ„äº‹é¡¹

1. **im-select ä¾èµ–**ï¼šå¿…é¡»å…ˆå®‰è£… im-select å·¥å…·
2. **æƒé™è¦æ±‚**ï¼šåº”ç”¨éœ€è¦è¾…åŠ©åŠŸèƒ½æƒé™æ¥æ£€æµ‹çª—å£å˜åŒ–
3. **macOS ä¸“ç”¨**ï¼šå½“å‰ç‰ˆæœ¬ä»…æ”¯æŒ macOS ç³»ç»Ÿ
4. **é…ç½®æ–‡ä»¶**ï¼šä¿®æ”¹é…ç½®åéœ€è¦é‡å¯åº”ç”¨ç”Ÿæ•ˆ

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **im-select å‘½ä»¤ä¸å­˜åœ¨**
   ```bash
   brew install im-select
   ```

2. **æ— æ³•æ£€æµ‹çª—å£å˜åŒ–**
   - æ£€æŸ¥ç³»ç»Ÿåå¥½è®¾ç½® > å®‰å…¨æ€§ä¸éšç§ > è¾…åŠ©åŠŸèƒ½
   - ç¡®ä¿åº”ç”¨å…·æœ‰å¿…è¦çš„æƒé™

3. **è¾“å…¥æ³•åˆ‡æ¢å¤±è´¥**
   - ç¡®è®¤è¾“å…¥æ³•IDæ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥ im-select æ˜¯å¦æ­£å¸¸å·¥ä½œ
   ```bash
   im-select  # æµ‹è¯•è·å–å½“å‰è¾“å…¥æ³•
   im-select com.apple.keylayout.ABC  # æµ‹è¯•åˆ‡æ¢è¾“å…¥æ³•
   ```

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚